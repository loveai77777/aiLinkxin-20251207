# ğŸ–¥ï¸ äº‘ä¸»æœºéƒ¨ç½²å®Œæ•´æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ å°†ç½‘ç«™éƒ¨ç½²åˆ°è‡ªå·±çš„äº‘ä¸»æœºä¸Šï¼Œå¹¶é€šè¿‡ VS Code è¿›è¡Œè¿œç¨‹å¼€å‘å’Œç®¡ç†ã€‚

---

## ğŸ“‹ éƒ¨ç½²æ¶æ„

```
GitHub â†’ æœåŠ¡å™¨ï¼ˆé€šè¿‡ VS Code SSH è¿æ¥ï¼‰â†’ Nginx â†’ Next.js (PM2) â†’ www.ailinkxin.com
```

---

## ğŸš€ ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æœåŠ¡å™¨ç¯å¢ƒ

### 1.1 é€šè¿‡ VS Code è¿æ¥åˆ°æœåŠ¡å™¨

#### å®‰è£… VS Code Remote SSH æ‰©å±•
1. æ‰“å¼€ VS Code
2. æŒ‰ `Ctrl+Shift+X` æ‰“å¼€æ‰©å±•é¢æ¿
3. æœç´¢å¹¶å®‰è£… **"Remote - SSH"** æ‰©å±•

#### é…ç½® SSH è¿æ¥
1. æŒ‰ `Ctrl+Shift+P` æ‰“å¼€å‘½ä»¤é¢æ¿
2. è¾“å…¥ `Remote-SSH: Connect to Host...`
3. é€‰æ‹© `Configure SSH Hosts...`
4. é€‰æ‹©é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ `C:\Users\ä½ çš„ç”¨æˆ·å\.ssh\config`ï¼‰
5. æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```
Host ailinkxin-server
    HostName ä½ çš„æœåŠ¡å™¨IPåœ°å€
    User root  # æˆ–ä½ çš„ç”¨æˆ·å
    Port 22
    IdentityFile C:\Users\ä½ çš„ç”¨æˆ·å\.ssh\id_rsa
```

6. ä¿å­˜æ–‡ä»¶
7. æŒ‰ `Ctrl+Shift+P`ï¼Œè¾“å…¥ `Remote-SSH: Connect to Host...`
8. é€‰æ‹© `ailinkxin-server` è¿æ¥

#### é¦–æ¬¡è¿æ¥
- è¾“å…¥æœåŠ¡å™¨å¯†ç 
- VS Code ä¼šåœ¨æœåŠ¡å™¨ä¸Šå®‰è£…å¿…è¦çš„ç»„ä»¶
- è¿æ¥æˆåŠŸåï¼Œå·¦ä¸‹è§’ä¼šæ˜¾ç¤º `SSH: ailinkxin-server`

---

### 1.2 åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…å¿…è¦è½¯ä»¶

é€šè¿‡ VS Code çš„ç»ˆç«¯ï¼ˆTerminal â†’ New Terminalï¼‰ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

#### æ›´æ–°ç³»ç»Ÿ
```bash
# Ubuntu/Debian
sudo apt update && sudo apt upgrade -y

# CentOS/RHEL
sudo yum update -y
```

#### å®‰è£… Node.js 18.x
```bash
# ä½¿ç”¨ NodeSource å®‰è£…
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# éªŒè¯å®‰è£…
node --version  # åº”è¯¥æ˜¾ç¤º v18.x.x
npm --version
```

#### å®‰è£… PM2ï¼ˆè¿›ç¨‹ç®¡ç†å™¨ï¼‰
```bash
sudo npm install -g pm2

# è®¾ç½® PM2 å¼€æœºè‡ªå¯
pm2 startup
# è¿è¡Œä¸Šé¢å‘½ä»¤è¾“å‡ºçš„å‘½ä»¤ï¼ˆé€šå¸¸æ˜¯ sudo env PATH=...ï¼‰
```

#### å®‰è£… Nginx
```bash
# Ubuntu/Debian
sudo apt install -y nginx

# CentOS/RHEL
sudo yum install -y nginx

# å¯åŠ¨ Nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

#### å®‰è£… Git
```bash
# Ubuntu/Debian
sudo apt install -y git

# CentOS/RHEL
sudo yum install -y git
```

---

## ğŸ“ ç¬¬äºŒæ­¥ï¼šåœ¨æœåŠ¡å™¨ä¸Šå…‹éš†é¡¹ç›®

### 2.1 åˆ›å»ºé¡¹ç›®ç›®å½•
```bash
sudo mkdir -p /var/www
cd /var/www
sudo git clone https://github.com/loveai77777/aiLinkxin-20251207.git ailinkxin
sudo chown -R $USER:$USER /var/www/ailinkxin
cd /var/www/ailinkxin
```

### 2.2 å®‰è£…ä¾èµ–
```bash
npm install
```

---

## âš™ï¸ ç¬¬ä¸‰æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

### 3.1 åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
```bash
cd /var/www/ailinkxin
nano .env.production
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰ï¼š
```env
NODE_ENV=production

# Dify API é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰
DIFY_API_BASE_URL=https://api.dify.ai
DIFY_API_KEY=your_dify_api_key_here

# å…¶ä»–ç¯å¢ƒå˜é‡
# ...
```

ä¿å­˜æ–‡ä»¶ï¼š`Ctrl+O` â†’ `Enter` â†’ `Ctrl+X`

---

## ğŸ”¨ ç¬¬å››æ­¥ï¼šæ„å»ºé¡¹ç›®

```bash
cd /var/www/ailinkxin
npm run build
```

---

## ğŸš€ ç¬¬äº”æ­¥ï¼šä½¿ç”¨ PM2 å¯åŠ¨åº”ç”¨

### 5.1 åˆ›å»º PM2 é…ç½®æ–‡ä»¶
åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `ecosystem.config.js`ï¼š

```bash
nano /var/www/ailinkxin/ecosystem.config.js
```

å†…å®¹å¦‚ä¸‹ï¼š
```javascript
module.exports = {
  apps: [{
    name: 'ailinkxin',
    script: 'npm',
    args: 'start',
    cwd: '/var/www/ailinkxin',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    }
  }]
};
```

### 5.2 å¯åŠ¨åº”ç”¨
```bash
cd /var/www/ailinkxin
pm2 start ecosystem.config.js

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs ailinkxin

# ä¿å­˜ PM2 é…ç½®ï¼ˆå¼€æœºè‡ªå¯ï¼‰
pm2 save
```

---

## ğŸŒ ç¬¬å…­æ­¥ï¼šé…ç½® Nginx åå‘ä»£ç†

### 6.1 åˆ›å»º Nginx é…ç½®æ–‡ä»¶
```bash
sudo nano /etc/nginx/sites-available/ailinkxin
```

æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š
```nginx
server {
    listen 80;
    server_name www.ailinkxin.com ailinkxin.com;

    # é‡å®šå‘åˆ° HTTPSï¼ˆé…ç½® SSL åå¯ç”¨ï¼‰
    # return 301 https://$server_name$request_uri;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}

# HTTPS é…ç½®ï¼ˆé…ç½® SSL åæ·»åŠ ï¼‰
# server {
#     listen 443 ssl http2;
#     server_name www.ailinkxin.com ailinkxin.com;
#
#     ssl_certificate /etc/letsencrypt/live/ailinkxin.com/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/ailinkxin.com/privkey.pem;
#
#     location / {
#         proxy_pass http://localhost:3000;
#         proxy_http_version 1.1;
#         proxy_set_header Upgrade $http_upgrade;
#         proxy_set_header Connection 'upgrade';
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#         proxy_cache_bypass $http_upgrade;
#     }
# }
```

### 6.2 å¯ç”¨ç«™ç‚¹
```bash
# åˆ›å»ºç¬¦å·é“¾æ¥
sudo ln -s /etc/nginx/sites-available/ailinkxin /etc/nginx/sites-enabled/

# æµ‹è¯• Nginx é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx
```

---

## ğŸ”’ ç¬¬ä¸ƒæ­¥ï¼šé…ç½® SSL è¯ä¹¦ï¼ˆHTTPSï¼‰

### 7.1 å®‰è£… Certbot
```bash
# Ubuntu/Debian
sudo apt install -y certbot python3-certbot-nginx

# CentOS/RHEL
sudo yum install -y certbot python3-certbot-nginx
```

### 7.2 è·å– SSL è¯ä¹¦
```bash
sudo certbot --nginx -d www.ailinkxin.com -d ailinkxin.com
```

æŒ‰ç…§æç¤ºï¼š
1. è¾“å…¥é‚®ç®±åœ°å€
2. åŒæ„æœåŠ¡æ¡æ¬¾
3. é€‰æ‹©æ˜¯å¦é‡å®šå‘ HTTP åˆ° HTTPSï¼ˆæ¨èé€‰æ‹© 2ï¼‰

### 7.3 è‡ªåŠ¨ç»­æœŸ
è¯ä¹¦ä¼šè‡ªåŠ¨ç»­æœŸï¼Œä½†å¯ä»¥æ‰‹åŠ¨æµ‹è¯•ï¼š
```bash
sudo certbot renew --dry-run
```

---

## ğŸ”„ ç¬¬å…«æ­¥ï¼šé…ç½®è‡ªåŠ¨éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰

### æ–¹æ¡ˆ Aï¼šæ‰‹åŠ¨éƒ¨ç½²è„šæœ¬

åˆ›å»ºéƒ¨ç½²è„šæœ¬ `deploy.sh`ï¼š
```bash
nano /var/www/ailinkxin/deploy.sh
```

å†…å®¹ï¼š
```bash
#!/bin/bash

echo "ğŸš€ å¼€å§‹éƒ¨ç½²..."

cd /var/www/ailinkxin

# æ‹‰å–æœ€æ–°ä»£ç 
echo "ğŸ“¥ æ‹‰å–æœ€æ–°ä»£ç ..."
git pull origin main

# å®‰è£…ä¾èµ–
echo "ğŸ“¦ å®‰è£…ä¾èµ–..."
npm install

# æ„å»ºé¡¹ç›®
echo "ğŸ”¨ æ„å»ºé¡¹ç›®..."
npm run build

# é‡å¯ PM2
echo "ğŸ”„ é‡å¯åº”ç”¨..."
pm2 restart ailinkxin

echo "âœ… éƒ¨ç½²å®Œæˆï¼"
```

è®¾ç½®æ‰§è¡Œæƒé™ï¼š
```bash
chmod +x /var/www/ailinkxin/deploy.sh
```

ä½¿ç”¨ï¼š
```bash
/var/www/ailinkxin/deploy.sh
```

### æ–¹æ¡ˆ Bï¼šGitHub Actions è‡ªåŠ¨éƒ¨ç½²

å¦‚æœè¦åœ¨ GitHub ä¸Šé…ç½®è‡ªåŠ¨éƒ¨ç½²ï¼Œéœ€è¦ï¼š
1. åœ¨æœåŠ¡å™¨ä¸Šç”Ÿæˆ SSH å¯†é’¥
2. å°†å…¬é’¥æ·»åŠ åˆ°æœåŠ¡å™¨çš„ `~/.ssh/authorized_keys`
3. å°†ç§é’¥æ·»åŠ åˆ° GitHub Secrets
4. å¯ç”¨ GitHub Actions å·¥ä½œæµ

---

## ğŸ“ ç¬¬ä¹æ­¥ï¼šé…ç½®åŸŸå DNS

åœ¨ä½ çš„åŸŸåæ³¨å†Œå•†å¤„é…ç½® DNSï¼š

**A è®°å½•ï¼ˆæ ¹åŸŸåï¼‰**ï¼š
```
ç±»å‹: A
åç§°: @
å€¼: ä½ çš„æœåŠ¡å™¨IPåœ°å€
TTL: 3600
```

**A è®°å½•ï¼ˆwwwå­åŸŸåï¼‰**ï¼š
```
ç±»å‹: A
åç§°: www
å€¼: ä½ çš„æœåŠ¡å™¨IPåœ°å€
TTL: 3600
```

æˆ–ä½¿ç”¨ CNAMEï¼š
```
ç±»å‹: CNAME
åç§°: www
å€¼: ailinkxin.com
TTL: 3600
```

ç­‰å¾… DNS ç”Ÿæ•ˆï¼ˆé€šå¸¸å‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ï¼‰ã€‚

---

## âœ… éªŒè¯éƒ¨ç½²

1. **æ£€æŸ¥ PM2 çŠ¶æ€**
   ```bash
   pm2 status
   ```

2. **æ£€æŸ¥ Nginx çŠ¶æ€**
   ```bash
   sudo systemctl status nginx
   ```

3. **è®¿é—®ç½‘ç«™**
   - http://www.ailinkxin.com
   - https://www.ailinkxin.comï¼ˆé…ç½® SSL åï¼‰

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### PM2 ç®¡ç†
```bash
pm2 status              # æŸ¥çœ‹çŠ¶æ€
pm2 logs ailinkxin      # æŸ¥çœ‹æ—¥å¿—
pm2 restart ailinkxin   # é‡å¯åº”ç”¨
pm2 stop ailinkxin      # åœæ­¢åº”ç”¨
pm2 delete ailinkxin    # åˆ é™¤åº”ç”¨
pm2 monit               # ç›‘æ§é¢æ¿
```

### Nginx ç®¡ç†
```bash
sudo systemctl status nginx    # æŸ¥çœ‹çŠ¶æ€
sudo systemctl restart nginx   # é‡å¯
sudo systemctl reload nginx    # é‡æ–°åŠ è½½é…ç½®
sudo nginx -t                  # æµ‹è¯•é…ç½®
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# PM2 æ—¥å¿—
pm2 logs ailinkxin

# Nginx è®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/access.log

# Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log

# Next.js æ—¥å¿—ï¼ˆé€šè¿‡ PM2ï¼‰
pm2 logs ailinkxin --lines 100
```

---

## ğŸ†˜ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: æ— æ³•é€šè¿‡ VS Code è¿æ¥æœåŠ¡å™¨
**è§£å†³**ï¼š
- æ£€æŸ¥æœåŠ¡å™¨é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ 22 ç«¯å£
- æ£€æŸ¥ SSH å¯†é’¥æ˜¯å¦æ­£ç¡®
- å°è¯•ä½¿ç”¨å¯†ç ç™»å½•æµ‹è¯•

### é—®é¢˜ 2: ç½‘ç«™æ— æ³•è®¿é—®
**æ£€æŸ¥**ï¼š
1. PM2 æ˜¯å¦è¿è¡Œï¼š`pm2 status`
2. Nginx æ˜¯å¦è¿è¡Œï¼š`sudo systemctl status nginx`
3. ç«¯å£æ˜¯å¦å¼€æ”¾ï¼š`sudo ufw status` æˆ– `sudo iptables -L`
4. DNS æ˜¯å¦ç”Ÿæ•ˆï¼š`nslookup www.ailinkxin.com`

### é—®é¢˜ 3: æ„å»ºå¤±è´¥
**è§£å†³**ï¼š
- æ£€æŸ¥ Node.js ç‰ˆæœ¬ï¼š`node --version`ï¼ˆåº”è¯¥æ˜¯ 18.xï¼‰
- æ¸…é™¤ç¼“å­˜ï¼š`rm -rf node_modules .next && npm install`
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`npm run build` çš„è¾“å‡º

### é—®é¢˜ 4: SSL è¯ä¹¦é—®é¢˜
**è§£å†³**ï¼š
- ç¡®ä¿åŸŸå DNS å·²æ­£ç¡®é…ç½®
- ç¡®ä¿ 80 å’Œ 443 ç«¯å£å·²å¼€æ”¾
- é‡æ–°ç”³è¯·è¯ä¹¦ï¼š`sudo certbot --nginx -d www.ailinkxin.com`

---

## ğŸ“š åç»­ç»´æŠ¤

### æ›´æ–°ç½‘ç«™
```bash
cd /var/www/ailinkxin
git pull origin main
npm install
npm run build
pm2 restart ailinkxin
```

æˆ–ä½¿ç”¨éƒ¨ç½²è„šæœ¬ï¼š
```bash
/var/www/ailinkxin/deploy.sh
```

### å¤‡ä»½
å®šæœŸå¤‡ä»½ï¼š
```bash
# å¤‡ä»½ä»£ç 
tar -czf ~/ailinkxin-backup-$(date +%Y%m%d).tar.gz /var/www/ailinkxin

# å¤‡ä»½æ•°æ®åº“ï¼ˆå¦‚æœæœ‰ï¼‰
# mysqldump -u user -p database > ~/database-backup-$(date +%Y%m%d).sql
```

---

## ğŸ‰ å®Œæˆï¼

ä½ çš„ç½‘ç«™ç°åœ¨åº”è¯¥å¯ä»¥é€šè¿‡ **https://www.ailinkxin.com** è®¿é—®äº†ï¼

**éœ€è¦å¸®åŠ©ï¼Ÿ** å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå‘Šè¯‰æˆ‘å…·ä½“çš„é”™è¯¯ä¿¡æ¯ã€‚

